<!-- hiring/templates/hiring/dashboard.html -->
{% extends "baseDashboard.html" %}
{% block title %}Hiring Dashboard{% endblock %}

{% block content %}
<h2>Applicant Dashboard</h2>

<input type="text" id="searchInput" class="form-control mb-3" placeholder="Search applicants...">

<table class="table table-bordered table-hover">
  <thead class="table-dark">
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Role</th>
      <th>ATS Score</th>
      <th>Status</th>
      <th>Resume</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="applicantTable">
    {% for applicant in applicants %}
    <tr>
      <td>{{ applicant.name }}</td>
      <td>{{ applicant.email }}</td>
      <td>{{ applicant.role }}</td>
      <td>{{ applicant.ats_score }}</td>
      
      <td>
        <span class="badge 
  {% if applicant.status == 'Pending' %}
    bg-warning
  {% elif applicant.status == 'Hired' %}
    bg-success
  {% else %}
    bg-secondary
  {% endif %}
">
  {{ applicant.status }}
</span>

      </td>
      <td>
      <a href="{{ applicant.resume.url }}" target="_blank" class="btn btn-primary">View Resume</a>

      </td>
      <td>
        {% if applicant.status == "Pending" %}
        <button onclick="updateStatus({{ applicant.id }}, 'Hired')" class="btn btn-sm btn-success">Hire</button>
        <button onclick="updateStatus({{ applicant.id }}, 'Rejected')" class="btn btn-sm btn-danger">Reject</button>
        {% else %}
        <button class="btn btn-sm btn-outline-secondary" disabled>Decision Made</button>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<script>
  function updateStatus(id, status) {
    fetch(`/update_status/${id}/`, {
      method: "POST",
      headers: {
        "X-CSRFToken": "{{ csrf_token }}",
        "Content-Type": "application/x-www-form-urlencoded"
      },
      body: `status=${status}`
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) location.reload();
    });
  }

  document.getElementById("searchInput").addEventListener("keyup", function () {
    const q = this.value.toLowerCase();
    document.querySelectorAll("#applicantTable tr").forEach(row => {
      row.style.display = row.textContent.toLowerCase().includes(q) ? "" : "none";
    });
  });
</script>
{% endblock %}
